---
title: 'Anchor Links: Getting Headers to be Links in Bookdown'
author: Desirée De Leon
date: '2019-08-05'
slug: bookdown-anchor-links
categories:
  - bookdown
tags:
  - R bookdown
subtitle: ''
summary: ''
authors: []
lastmod: '2019-08-05T16:52:58-04:00'
featured: no
image:
  caption: ''
  focal_point: ''
  preview_only: no
projects: []
---



<p>Anchor links: Getting headers to be links in bookdown</p>
<p>Many markdown files within R have built-in ways to get a link to a specific section headings. These are called anchor links. For example, what you see here:</p>
<div class="figure">
<img src="example.png" alt="example_anchor_link" style="width:50.0%" />
<p class="caption">example_anchor_link</p>
</div>
<p>Having these in a site is useful whenever you want to share a specific section with someone–and you want to send them a link that will take them to precisely the section you intend.</p>
<p>But in bookdown, there’s no built-in way to create anchor links with an icon for each section header. The closest you can get is to right-click on the header within the table of contents (TOC) and copy its URL address. But sometimes the subsection you want to link to doesn’t appear in the TOC, and you’re out of luck.</p>
<p>If you want to make linking to sections a little easier for yourself and for your bookdown site users, then follow the steps below to create your own anchor links to bookdown section headers.</p>
<p>Doing this will require:</p>
<ol style="list-style-type: decimal">
<li><p>A wee bit of javascript in a .js file (“but I know <em>nothing</em> about javascript!” you say?–don’t worry, you don’t need to. Copy/paste is all you need).</p></li>
<li><p>An HTML file if you don’t already have one for your book.</p></li>
<li><p>CSS</p></li>
<li><p>Editing output.yml</p></li>
</ol>
<p>Adding all this in is a little bit like wrapping a present in a box, in a box, in another box… The javascript does the heavy lifting to make the links, but the javascript file has to be put in the HTML file, and the HTML file has to be referenced in the output.yml file. And bookdown then uses the output.yml file to implement the javascript code and link to the CSS that styles the anchors.</p>
<p><img src="many_boxes.jpg" alt="schematic" />
___</p>
<p>Let’s get started!</p>
<p>You can add anchor links to any book that you’ve already started.</p>
<p>I’m going to demo this starting from a skeletal book, using only the files that are created when you have a brand new R Project and have run the following. If you already have a book, then skip to the next step.</p>
<p><code>bookdown:::bookdown_skeleton(getwd())</code></p>
<p>After running this command,I <a href="https://github.com/dcossyleon/anchor_book/commit/86ebbf94442ad2127a0c447823bfd6150be80291">commit</a> to GitHub.</p>
<div id="add-javascript-to-make-anchor-links-for-all-section-headers" class="section level1">
<h1>Add javascript to make anchor links for all section headers</h1>
<p>We’ll make a javascript file. This file is going to have the actual javascript that essentially says “find every section header and tack on a link to itself right before the header”. The other important thing the javascript file will do is to add a CSS class “hasAnchor” to each of the headers. This is part of what will allow to style our anchor links with CSS in a couple steps.</p>
<ol style="list-style-type: decimal">
<li>In RStudio go to <em>File</em> &gt; <em>New File</em> &gt; *Text File</li>
<li>Paste the javascript below into this file.</li>
</ol>
<pre><code>$(document).ready(function() {

  // Section anchors
  $(&#39;.section h1, .section h2, .section h3, .section h4, .section h5&#39;).each(function() {
    anchor = &#39;#&#39; + $(this).parent().attr(&#39;id&#39;);
    $(this).addClass(&quot;hasAnchor&quot;).prepend(&#39;&lt;a href=&quot;&#39; + anchor + &#39;&quot; class=&quot;anchor&quot;&gt;&lt;/a&gt;&#39;);
  });
});
</code></pre>
<ol start="3" style="list-style-type: decimal">
<li>Save this file as <code>book.js</code>. (You can give it another name, but the convention is usually to name the Javascript file after the project you’re using it for.) Save this file in your working directory. Phew–you’re done with the javascript code now!</li>
</ol>
<p><a href="https://github.com/dcossyleon/anchor_book/commit/b53c7f06660338754fc6dc10180710d935fcecd2">Commit</a> this new file to GitHub.</p>
</div>
<div id="embed-book.js-into-html-file" class="section level1">
<h1>Embed <code>book.js</code> into HTML file</h1>
<p>We’ll make an HTML file that will refer to our javascript file.</p>
<ol style="list-style-type: decimal">
<li><p><em>File</em> &gt; <em>New File</em> &gt; *Text File</p></li>
<li>Paste the line below into this file. Modify the path in quotes to point to your javascript file, if yours is not in your working directory. (Note: This little line of code will be automatically injected within our bookdown’s existing
<html>
and
<head>
<p>tags, when we later use <code>includes: in_header:</code> so there’s no need to include these tags in this HTML file, but nothing bad will happen if you do).</p></li>
</ol>
<script src="book.js"></script>
<ol start="3" style="list-style-type: decimal">
<li>Save this file as <code>header.html</code> in your project directory. You can choose a different name if you’d like.</li>
</ol>
<p><a href="https://github.com/dcossyleon/anchor_book/commit/5fcb3fcc5b355110b656f2dd0a30b7c8f142ae1b">Commit</a> your HTML file to GitHub.</p>
</div>
<div id="add-css-to-show-anchor-links" class="section level1">
<h1>Add CSS to show anchor links</h1>
<p>In our javascript code, we had the class “hasAnchor” be programatically added to our sections headers. So, we can now style them so that each time we hover over the section header, the anchor link icon will become visible.</p>
<ol style="list-style-type: decimal">
<li><p>You may already have a CSS file in your project directory (e.g. <code>style.css</code>), in which case, go to step 2. But if you don’t, create a CSS file with <em>File</em> &gt; <em>New File</em> &gt; <em>Text File</em>. Save it as <code>style.css</code> in your project directory. Once again, a different name is okay.</p></li>
<li><p>Open your <code>style.css</code> file. Paste the CSS styles below to this file.</p></li>
<li><p>Save and close.</p></li>
</ol>
<pre><code>/* -----------Section anchors -------------*/

.book .book-body .page-wrapper .page-inner section.normal {
  overflow: visible !important; /*so anchor link doesn&#39;t get cut off */
}

a.anchor {
  margin-left: -30px;
  padding-right: 3px;
  display:inline-block;
  width: 30px;
  height: 30px;
  background-image: url(https://image.flaticon.com/icons/svg/34/34735.svg) !important;
  background-repeat: no-repeat !important;
  background-size: 20px 20px !important;
  background-position: center bottom !important;
  opacity: 0;
}


.hasAnchor:hover a.anchor, a.anchor:hover {
  opacity: 0.6;
}

@media (max-width: 1144px) { /* don&#39;t show anchor link on small screens */
  .hasAnchor:hover a.anchor {
    visibility: hidden;
  }
}
</code></pre>
<p>If you want a few more details about what’s going on here, here’s a crude summary:</p>
<ul>
<li><p><code>a.anchor</code> styles the anchor link itself. It is always there, but we make it invisible by giving it an opacity of 0. Since it’s always there, positioned just before the headers, we need to give the anchor link a negative margin, so it can exist just <em>outside</em> the typical margins of our book’s container for body text.</p></li>
<li><p>Bookdown by default tries to prevent overflow of anything outside of the book’s container for body text, which is why we have to override this with by adding <code>overflow: visible</code> in the first style rule.</p></li>
<li><p>In the third style rule, we can make the anchor visible by giving it a non-zero opacity whenever we hover.</p></li>
<li><p>Finally, since we made overflow possible, we don’t want the anchor to overlap with the TOC in an ugly mess on smaller screens. So we change visibility to hidden with our CSS media query for screens that are less than 1144px in the last style rule.</p></li>
</ul>
<p>Here’s my <a href="https://github.com/dcossyleon/anchor_book/commit/29900eeec766970e83282dda4e9e77e259aa9ce3">commit</a> after modifying my CSS file.</p>
</div>
<div id="add-anchor-link-elements-to-output.yml" class="section level1">
<h1>Add anchor link elements to <code>output.yml</code></h1>
<p>We created all the anchor link infrastructure, now we just need to tell bookdown about it by referencing in our <code>output.yml</code>.</p>
<ol style="list-style-type: decimal">
<li>Open <code>output.yml</code>, located in your project directory</li>
<li>Reference your HTML file with the <code>includes: in_header:</code> option underneath bookdown::gitbook. Make sure CSS file is also referenced. This part of your output.yml should look something like this:</li>
</ol>
<pre><code>bookdown::gitbook:
  includes:
    in_header: header.html
  css: style.css
</code></pre>
<ol start="3" style="list-style-type: decimal">
<li>Save and Close.</li>
</ol>
<p>My <a href="https://github.com/dcossyleon/anchor_book/commit/55e10ddfd09a50a7410add7f653228927d38cdf0">commit here</a>.</p>
</div>
<div id="preview-your-book" class="section level1">
<h1>Preview your book</h1>
<p>And enjoy your handywork!</p>
<p>View all my commits for this post <a href="https://github.com/dcossyleon/anchor_book/commits/master">here</a>.</p>
</div>
